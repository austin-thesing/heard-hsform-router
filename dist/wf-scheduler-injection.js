(function(){let M=window.location.search.includes("debug=true");function J(...j){if(M)console.log("[Webflow Scheduler]",...j)}let V={over_100k:{url:"https://meetings.hubspot.com/bz/consultation",name:"Consultation Scheduler",description:"Revenue over $100k"},under_100k:{url:"https://meetings.hubspot.com/bz/consultations",name:"Consultations Scheduler",description:"Revenue under $100k or not provided"}};function B(){try{let j=sessionStorage.getItem("scheduler_router_data");if(j){let q=JSON.parse(j);return J("Found router data in sessionStorage:",q),sessionStorage.removeItem("scheduler_router_data"),{formData:q.formData,schedulerType:q.scheduler_type,source:"sessionStorage"}}}catch(j){J("sessionStorage error:",j)}try{let j=localStorage.getItem("hubspot_form_data");if(j){let q=JSON.parse(j);return J("Found form data in localStorage:",q),{formData:q,source:"localStorage"}}}catch(j){J("localStorage error:",j)}try{let j=(W)=>{let X=`; ${document.cookie}`.split(`; ${W}=`);if(X.length===2)return X.pop().split(";").shift()},q=j("scheduler_type"),K=j("form_data");if(q||K){let W=K?JSON.parse(atob(K)):{};return document.cookie="scheduler_type=; path=/; max-age=0",document.cookie="form_data=; path=/; max-age=0",J("Found data in cookies:",{schedulerType:q,formData:W}),{formData:W,schedulerType:q,source:"cookies"}}}catch(j){J("cookie error:",j)}return null}function Q(){let j={},q=new URLSearchParams(window.location.search);for(let[K,W]of q)j[K]=W;return j}function R(j,q){if(j&&j.schedulerType)return j.schedulerType;if(j&&j.formData&&j.formData.scheduler_type)return j.formData.scheduler_type;if(q&&q.scheduler_type)return q.scheduler_type;return"under_100k"}function L(j,q){let K=V[q]||V.under_100k,W=new URL(K.url);W.searchParams.set("embed","true");let Z=j.partnerstack_click_id||j.ps_xid||j["0-1/partnerstack_click_id"]||j["0-2/partnerstack_click_id"];if(Z)W.searchParams.set("partnerstack_click_id",Z),J("Adding PartnerStack click id",Z);return Object.entries({email:["email","email_address","0-1/email","0-2/email"],firstname:["firstname","first_name","fname","0-1/firstname","0-2/firstname"],lastname:["lastname","last_name","lname","0-1/lastname","0-2/lastname"],company:["company","practice_name","business_name","0-1/company","0-2/company"],phone:["phone","phone_number","telephone","0-1/phone","0-2/phone"]}).forEach(([z,$])=>{for(let Y of $)if(j[Y]){W.searchParams.set(z,j[Y]),J(`Mapping ${Y} -> ${z}: ${j[Y]}`);break}}),["is_your_practice_a_c_corp_or_our_does_it_have_multiple_owners_","what_best_describes_your_practice_","referrer","submissionGuid","uuid","partnerstack_click_id"].forEach((z)=>{if(j[z])W.searchParams.set(z,j[z]),J(`Adding additional field: ${z} = ${j[z]}`);else{let $=[`0-1/${z}`,`0-2/${z}`];for(let Y of $)if(j[Y]){W.searchParams.set(z,j[Y]),J(`Adding prefixed field: ${Y} -> ${z} = ${j[Y]}`);break}}}),["utm_source","utm_medium","utm_campaign","utm_content","utm_term"].forEach((z)=>{if(j[z])W.searchParams.set(z,j[z])}),J("Built scheduler URL:",W.toString()),W.toString()}function v(j){try{if(window.location.hostname.includes("joinheard.com")){if(typeof rdt==="function")rdt("track","Lead");if(typeof fbq==="function")fbq("track","Lead")}if(typeof gtag<"u")gtag("event","generate_lead",{event_category:"engagement",event_label:j||"unknown"});else if(typeof ga<"u")ga("send","event","Lead","Generate",j||"unknown");if(typeof window.posthog<"u")window.posthog.capture("scheduler_lead_generated",{scheduler_type:j||"unknown",source:"webflow_complete"});if(typeof window.amplitude<"u")window.amplitude.track("scheduler_lead_generated",{scheduler_type:j||"unknown",source:"webflow_complete"});J("Lead events fired")}catch(q){J("Lead tracking error:",q)}}function G(){J("Starting scheduler setup...");let j=Q(),q=B(),K={...j};if(q&&q.formData)K={...K,...q.formData},J("Merged form data from storage:",K);let W=R(q,K);if(!(K.email||K.firstname||K.first_name||K["0-1/email"]||K["0-1/firstname"]||K["0-2/email"]||K["0-2/firstname"]||Object.keys(K).some((z)=>z!=="debug"&&z!=="utm_source"&&z!=="utm_medium"&&z!=="utm_campaign"&&!z.startsWith("group[")&&K[z]))){J("No form data found, redirecting to /free-consult"),window.location.href="/free-consult";return}J("Form data found, setting up scheduler");let X=document.getElementById("scheduler-target");if(!X){let z=document.querySelector('iframe[src*="meetings.hubspot.com"]'),$=document.querySelector(".meetings-iframe-container");if(z||$){J("Found existing iframe/container, will enhance it");let Y=document.createElement("div");if(Y.id="scheduler-target",$)$.parentNode.insertBefore(Y,$),Y.appendChild($);else if(z)z.parentNode.insertBefore(Y,z),Y.appendChild(z);X=Y}}if(!X)J("No target found, creating scheduler-target div"),X=document.createElement("div"),X.id="scheduler-target",X.style.cssText="min-height: 600px; width: 100%;",document.body.appendChild(X);let H=L(K,W);J("Injecting scheduler into target"),J("Final URL:",H),X.innerHTML=`<div class="meetings-iframe-container" data-src="${H}"></div>`;let A=document.createElement("script");return A.src="https://static.hsappstatic.net/MeetingsEmbed/ex/MeetingsEmbedCode.js",A.onload=function(){J("HubSpot embed script loaded successfully"),v(W)},A.onerror=function(){console.error("[Webflow Scheduler] Failed to load HubSpot embed script")},document.head.appendChild(A),!0}function w(){if(!M)return;let j=document.createElement("div");j.style.cssText=`
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 15px;
      border-radius: 8px;
      font-family: monospace;
      font-size: 12px;
      max-width: 400px;
      z-index: 10000;
      border: 2px solid #226752;
    `;let q=B(),K=new URLSearchParams(window.location.search);j.innerHTML=`
      <strong>\uD83D\uDD27 Webflow Scheduler Debug</strong><br><br>
      <strong>Form Data Sources:</strong><br>
      \uD83D\uDCC1 localStorage: ${localStorage.getItem("hubspot_form_data")?"✅ Found":"❌ Empty"}<br>
      \uD83D\uDCBE sessionStorage: ${sessionStorage.getItem("scheduler_router_data")?"✅ Found":"❌ Empty"}<br>
      \uD83C\uDF6A Cookies: ${document.cookie.includes("form_data=")?"✅ Found":"❌ Empty"}<br><br>
      <strong>URL Parameters:</strong><br>
      ${K.toString()||"None"}<br><br>
      <strong>Stored Data:</strong><br>
      ${q?`Source: ${q.source}<br>Fields: ${Object.keys(q.formData||{}).join(", ")}`:"None found"}<br><br>
      <strong>Scheduler Type:</strong><br>
      ${R(q,Q())}<br><br>
      <strong>Action:</strong><br>
      ${q||K.toString()?"✅ Loading scheduler":"❌ Will redirect to /free-consult"}
    `,document.body.appendChild(j);let W=!1,Z={x:0,y:0};j.addEventListener("mousedown",(X)=>{W=!0,Z.x=X.clientX-j.offsetLeft,Z.y=X.clientY-j.offsetTop}),document.addEventListener("mousemove",(X)=>{if(W)j.style.left=X.clientX-Z.x+"px",j.style.top=X.clientY-Z.y+"px",j.style.right="auto"}),document.addEventListener("mouseup",()=>{W=!1})}function _(){J("Webflow Scheduler Complete initializing..."),w(),G(),J("Webflow Scheduler Complete initialized")}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",_);else _();if(M)window.WebflowSchedulerComplete={getStoredFormData:B,getQueryParams:Q,buildSchedulerUrl:L,handleScheduler:G,fireLeadEvents:v,resolveSchedulerType:R,init:_,config:V};J("Webflow Scheduler Complete script loaded")})();
