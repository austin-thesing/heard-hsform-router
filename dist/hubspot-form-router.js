(function(){let K={general:{url:"https://meetings.hubspot.com/bz/consultation",name:"Consultation Scheduler",description:"General consultation scheduling"}},N={success:"/thank-you/success",schedule:"/thank-you/schedule"},I={portalId:"7507639",formId:"233427c7-d504-46f3-9b75-9c798c25e5fc",apiEndpoint:"https://api.hsforms.com/submissions/v3/integration/submit/7507639/233427c7-d504-46f3-9b75-9c798c25e5fc",fieldName:"partial_fill_source"},g=["do_you_file_taxes_as_an_independent_contractor_or_as_the_sole_owner_of_your_business_","does_your_practice_have_multiple_owners"],_=["yes","true","y","1","multiple owners","multi"],D=["no","false","n","0"];function y(q){if(q==null)return"";return String(q).trim().toLowerCase()}function r(q){let Q=y(q);if(!Q)return!1;if(_.includes(Q))return!0;return Q.startsWith("yes")||Q.includes("multiple owners")||Q.includes("multi practice")||Q.includes("multi-owner")||Q.includes("multi owner")||Q.includes("multi-practice")}function l(q){let Q=y(q);if(!Q)return!1;if(D.includes(Q))return!0;return Q.startsWith("no")}function T(q,Q){if(!q)return null;for(let J of Q){if(q[J])return q[J];let j=[`0-1/${J}`,`0-2/${J}`,`0-3/${J}`];for(let Z of j)if(q[Z])return q[Z]}return null}let P=window.location.hostname==="localhost"||window.location.search.includes("debug=true");function W(...q){if(P)console.log("[HubSpot Router]",...q)}let V="partnerstack_click_id",S=[V,"ps_xid","psx_id"],c=["ps_xid","psx_id"];function F(q){try{if(!document.cookie)return null;let Q=document.cookie.split(";");for(let J of Q){let j=J.trim();if(!j)continue;if(j.startsWith(`${q}=`)){let[,Z]=j.split("=");if(Z)return decodeURIComponent(Z)}}}catch(Q){W(`cookie access error for ${q}:`,Q)}return null}function E(q){if(!q)return;let Q=S.flatMap((j)=>[`input[name="${j}"]`,`input[name$="/${j}"]`]);if(Q.length===0)return;let J;try{J=document.querySelectorAll(Q.join(", "))}catch(j){W("Failed to query partnerstack inputs:",j);return}if(!J||J.length===0)return;window._capturedFormData=window._capturedFormData||{},J.forEach((j)=>{if(!j||typeof j.name!=="string")return;if(!j.value)j.value=q;window._capturedFormData[j.name]=j.value;let Z=U(j.name);if(Z&&Z!==j.name)window._capturedFormData[Z]=j.value;W("Prefilled partnerstack id field:",j.name,"=",j.value)})}function C(){let q=[];for(let j of c){let Z=F(j);if(Z)q.push(Z)}try{if(window.partnerstack&&window.partnerstack.ps_xid)q.push(window.partnerstack.ps_xid)}catch(j){W("Partnerstack global lookup error:",j)}try{if(window.ps_xid)q.push(window.ps_xid)}catch(j){W("ps_xid global lookup error:",j)}try{S.forEach((j)=>{let Z=localStorage.getItem(j);if(Z)q.push(Z)})}catch(j){W("localStorage access error for partnerstack id:",j)}try{S.forEach((j)=>{let Z=sessionStorage.getItem(j);if(Z)q.push(Z)})}catch(j){W("sessionStorage access error for partnerstack id:",j)}let Q=F(V);if(Q&&!q.includes(Q))q.push(Q);return q.find((j)=>j&&j!=="undefined"&&j!=="null")||null}function v(q,Q,J){if(!q||h||O)return;try{let j=`Partial: ${Q} | ${J}`,Z=F("hubspotutk"),$={fields:[{name:"email",value:q},{name:I.fieldName,value:j}],context:{pageUri:window.location.href,pageName:document.title||"Untitled Page"}};if(Z)$.context.hutk=Z;let w=JSON.stringify($);fetch(I.apiEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:w,keepalive:!0}).then((Y)=>{if(Y.ok)h=!0,W("Partial fill submitted:",{email:q,formName:Q,pageUrl:J}),W("Partial fill sent successfully:",{email:q,formName:Q,pageUrl:J});else W("Partial fill failed:",Y.status,Y.statusText)}).catch((Y)=>{W("Partial fill error:",Y)}),h=!0}catch(j){W("Error submitting partial fill:",j)}}window.HubSpotRouter=window.HubSpotRouter||{},window.HubSpotRouter.DEBUG=P;let O=!1,G=null,h=!1,b="Unknown Form";function U(q){try{if(!q)return"";let Q=String(q);return Q.indexOf("/")!==-1?Q.split("/").pop():Q}catch(Q){return q}}function f(q){let Q={};if(!q)return Q;if(Array.isArray(q))return q.forEach((J)=>{if(!J)return;let j=J.name||J.field||"",Z=U(j),$=typeof J.value==="string"?J.value:Array.isArray(J.value)?J.value[0]:J.value!=null?String(J.value):"";if(j)Q[j]=$;if(Z&&Z!==j)Q[Z]=$}),Q;if(q.fields){let J=q.fields;if(Array.isArray(J))J.forEach((j)=>{if(!j)return;let Z=j.name||j.field||"",$=U(Z),w=typeof j.value==="string"?j.value:Array.isArray(j.value)?j.value[0]:j.value!=null?String(j.value):"";if(Z)Q[Z]=w;if($&&$!==Z)Q[$]=w});else if(typeof J==="object")Object.entries(J).forEach(([j,Z])=>{let $=U(j),w=typeof Z==="string"?Z:Array.isArray(Z)?Z[0]:Z!=null?String(Z):"";if(Q[j]=w,$&&$!==j)Q[$]=w});return Q}return Object.entries(q).forEach(([J,j])=>{let Z=U(J),$=typeof j==="string"?j:Array.isArray(j)?j[0]:j!=null?String(j):"";if(Q[J]=$,Z&&Z!==J)Q[Z]=$}),Q}function L(q){return"general"}function A(q,Q){let J=K[q]||K.general,j=new URL(J.url);return j.searchParams.set("embed","true"),Object.entries({email:["email","email_address"],firstName:["firstname","first_name","fname"],lastName:["lastname","last_name","lname"],company:["company","practice_name","business_name"],phone:["phone","phone_number","telephone"]}).forEach(([w,Y])=>{for(let X of Y)if(Q[X]){j.searchParams.set(w,Q[X]),W(`Mapping ${X} -> ${w}: ${Q[X]}`);break}}),["utm_source","utm_medium","utm_campaign","utm_content","utm_term"].forEach((w)=>{if(Q[w])j.searchParams.set(w,Q[w])}),W("Built scheduler URL:",j.toString()),j.toString()}function s(q,Q){if(Q==="success"){let $=new URLSearchParams;if(q.email)$.set("email",q.email);let w=`${N.success}${$.toString()?"?"+$.toString():""}`;W("Redirecting to success page for soft rejection:",w);try{window.location.replace(w)}catch(Y){W("replace() failed, using href for success redirect",Y),window.location.href=w}return}let J={scheduler_type:Q,formData:q,timestamp:Date.now(),source:"hubspot_form"};try{sessionStorage.setItem("scheduler_router_data",JSON.stringify(J)),W("Stored router data in sessionStorage")}catch($){W("Failed to store in sessionStorage, falling back to cookies"),document.cookie=`scheduler_type=${Q}; path=/; max-age=3600`,document.cookie=`form_data=${btoa(JSON.stringify(q))}; path=/; max-age=3600`}try{localStorage.setItem("hubspot_form_data",JSON.stringify(q)),W("Stored form data in localStorage for prefill")}catch($){W("Failed to store form data in localStorage:",$)}let j=new URLSearchParams;if(q.email)j.set("email",q.email);let Z=`${N.schedule}${j.toString()?"?"+j.toString():""}`;W("Redirecting to:",Z);try{window.location.replace(Z)}catch($){W("replace() failed, using href for scheduler redirect",$),window.location.href=Z}}function M(q,Q={}){if(W("Form submission detected:",q),O){W("Routing already performed; skipping");return}O=!0;let J=C();if(J){if(!q[V])q[V]=J;try{sessionStorage.setItem(V,J)}catch(Z){W("Failed to persist partnerstack id in sessionStorage:",Z)}try{localStorage.setItem(V,J)}catch(Z){W("Failed to persist partnerstack id in localStorage:",Z)}}let j=L(q);if(s(q,j),typeof window.amplitude<"u")window.amplitude.track("scheduler_router_triggered",{scheduler_type:j,has_email:!!q.email,has_name:!!(q.firstname||q.first_name)});if(typeof window.posthog<"u")window.posthog.capture("scheduler_router_triggered",{scheduler_type:j,method:"redirect"})}function d(){window._capturedFormData=window._capturedFormData||{};let q={},Q=new WeakSet;function J($,w="change"){if(!$.name)return;let Y=$.name,X=U(Y),z=$.value,x=z;if($.type==="radio"){let H=$.closest("label");if(H&&H.textContent){let B=H.textContent.replace(/\s+/g," ").trim();if(B)x=B}}if(q[Y]===x)return;if(q[Y]=x,Y==="hs_context"||Y.startsWith("hs_")||Y==="guid")return;if(window._capturedFormData[Y]=x,X&&X!==Y)window._capturedFormData[X]=x;if($.type==="radio"){if(window._capturedFormData[`${Y}_raw`]=z,X&&X!==Y)window._capturedFormData[`${X}_raw`]=z;let H=document.querySelector(`input[type="hidden"][name="${Y}"]`);if(H&&H.value){if(window._capturedFormData[Y]=H.value,X&&X!==Y)window._capturedFormData[X]=H.value;x=H.value}}if(x){let H=$.type||$.tagName.toLowerCase();if($.type==="tel"||Y.toLowerCase().includes("phone")){let B=x.replace(/[\s\-\(\)\.]/g,"");if(B)window._capturedFormData[Y+"_clean"]=B;W("Captured phone:",Y,"=",x)}else if($.type==="radio")W("Captured radio selection:",Y,"=",x,"(raw:",z,")");else if($.type==="hidden"){if(Y==="hs_context"||Y.startsWith("hs_")||Y==="guid")return;if($.closest(".hsfc-DropdownField"))W("Captured dropdown:",Y,"=",x);else W("Captured field:",Y,"=",x)}else W("Captured",H+":",Y,"=",x)}}function j(){try{let $=document.querySelector("form[data-form-id], .hbspt-form, .hs-form");if($){let w=$.closest('[class*="form"], [id*="form"]');if(w){let X=w.querySelector("h1, h2, h3, h4");if(X&&X.textContent){let z=X.textContent.trim();if(z&&z.length<100){b=z,W("Detected form name from DOM heading:",b);return}}}let Y=$.getAttribute("data-form-id");if(Y){b=`Form ${Y}`,W("Detected form ID from DOM:",b);return}}}catch($){W("Error detecting form name from DOM:",$)}}function Z(){let $=C();if($)E($);j();let w=new MutationObserver((X)=>{let z=[];if(X.forEach((x)=>{x.addedNodes.forEach((H)=>{if(H.nodeType===1)z.push(H)})}),z.length===0)return;z.forEach((x)=>{let H=x.querySelectorAll?x.querySelectorAll("input[name], select[name], textarea[name]"):[];if(x.tagName&&(x.tagName==="INPUT"||x.tagName==="SELECT"||x.tagName==="TEXTAREA")&&x.name)Y(x);H.forEach((B)=>Y(B))})});function Y(X){if(Q.has(X))return;if(Q.add(X),X.readOnly&&X.type!=="hidden")return;let z=X.name?U(X.name):"";if((X.name===V||z===V)&&!X.value){let x=C();if(x)X.value=x,J(X,"partnerstack_prefill")}if(X.type==="hidden"&&X.name){let x=X.value,H=setInterval(()=>{if(X.value!==x)x=X.value,J(X,"programmatic");if(!document.body.contains(X))clearInterval(H)},500);if(X.value)J(X,"initial");else{let B=C();if(B&&(X.name===V||U(X.name)===V))X.value=B,J(X,"partnerstack_prefill_hidden")}}else if(X.type==="radio")X.addEventListener("change",()=>J(X));else if(X.type==="tel"||X.name&&X.name.toLowerCase().includes("phone"))X.addEventListener("blur",()=>J(X)),X.addEventListener("change",()=>J(X));else if(X.addEventListener("change",()=>J(X)),X.addEventListener("blur",()=>J(X)),X.value)J(X,"initial")}document.querySelectorAll("input[name], select[name], textarea[name]").forEach(Y),w.observe(document.body,{childList:!0,subtree:!0}),W("Form input monitoring activated")}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",Z);else Z()}function k(q){if(!q)return!1;let Q=!!T(q,g);return Boolean(q.email||q.firstname||q.first_name||q.lastname||q.last_name||q.company||q.practice_name)||Q}function m(){if(O){if(G)clearTimeout(G),G=null;return}if(!window._capturedFormData||Object.keys(window._capturedFormData).length===0){if(P)W("Multistep completion check: No form data captured yet");return}if(P)W("Multistep completion check: Checking for thank you message...",{hasFormData:!!window._capturedFormData,formDataKeys:Object.keys(window._capturedFormData).length});let q=[".submitted-message",".hs_submit_success",".hs-form-success","[data-submitted-message]",".submitted-message-content"];for(let Q of q)try{let J=document.querySelector(Q);if(J){let j=(J.textContent||J.innerText||"").toLowerCase();if(j.includes("thank")||j.includes("submitted")||j.includes("success")){if(W("Multistep form completion detected via thank you message"),W("Thank you message found",{selector:Q,text:j.substring(0,100),hasRoutingData:k(window._capturedFormData)}),k(window._capturedFormData))W("Triggering redirect from multistep fallback"),W("Executing redirect via fallback"),M(window._capturedFormData);else W("Thank you found but no routing data available");return}}}catch(J){}}function p(q={}){W("Initializing postMessage listener"),window.addEventListener("message",function(Q){if(!function(w){try{let Y=new URL(w).hostname;return Y.endsWith("hubspot.com")||Y.endsWith("hsforms.com")||Y.endsWith("hsforms.net")||Y.endsWith("hsappstatic.net")||Y.includes("hubspot")||Y.includes("hsforms")}catch(Y){return!1}}(Q.origin))return;let j=Q.data;if(typeof j==="string")try{j=JSON.parse(j)}catch(w){}W("Received message from HubSpot:",j);let Z=j&&(j.type||j.messageType),$=j&&j.eventName;if(j&&Z==="hsFormCallback"&&$==="onFormReady")try{if(j.data&&j.data.formName)b=j.data.formName,W("Detected form name from onFormReady:",b);else if(j.id)b=`Form ${j.id}`,W("Using form ID as name:",b)}catch(w){W("Error detecting form name:",w)}if(j&&Z==="hsFormCallback"&&($==="onFormSubmitted"||$==="onFormSubmit")){let w=j&&j.data?f(j.data):{},X={...window._capturedFormData&&typeof window._capturedFormData==="object"?window._capturedFormData:{},...w};if(!k(X)){if($==="onFormSubmit"){if(W("onFormSubmit received without routing fields; waiting for onFormSubmitted event"),!G)W("Setting up multistep fallback timer"),G=setTimeout(()=>{W("Starting multistep completion checks");let z=0,x=10,H=setInterval(()=>{if(z++,P||z===1||z===x)W(`Multistep check ${z}/${x}`);if(m(),O||z>=x){if(clearInterval(H),G=null,z>=x)W("Multistep fallback checks completed without redirect")}},500)},1000)}else W("Submission payload lacks routing data; skipping redirect");return}if(G)clearTimeout(G),G=null;try{window._capturedFormData={...X}}catch(z){W("Failed to persist merged submission data globally:",z)}M(X,q)}else if(j&&j.formGuid&&j.accepted===!0){if(W("Developer embed submission detected"),W("Using captured form data:",window._capturedFormData),window._capturedFormData&&Object.keys(window._capturedFormData).length>0){if(G)clearTimeout(G),G=null;try{localStorage.setItem("hubspot_form_data",JSON.stringify(window._capturedFormData)),W("Stored captured form data in localStorage for prefill")}catch(w){W("Failed to store captured form data in localStorage:",w)}M(window._capturedFormData,q)}}else if(j&&Z==="hsFormCallback"&&P)W("Ignoring hsFormCallback event:",$)}),W("PostMessage listener initialized")}function u(){function q(){if(document.visibilityState==="hidden")if(W("Visibility changed to hidden",{HAS_ROUTED:O,PARTIAL_FILL_SENT:h,capturedData:window._capturedFormData}),!O&&!h){let J=window._capturedFormData&&window._capturedFormData.email;if(J){let j=window.location.pathname;v(J,b,j),W("Partial fill triggered on visibility change")}else W("No email captured yet, skipping partial fill")}else W("Skipping partial fill:",{reason:O?"Form already routed":"Partial fill already sent"})}function Q(){if(W("Page hide event",{HAS_ROUTED:O,PARTIAL_FILL_SENT:h,capturedData:window._capturedFormData}),!O&&!h){let J=window._capturedFormData&&window._capturedFormData.email;if(J){let j=window.location.pathname;v(J,b,j),W("Partial fill triggered on page hide")}}}document.addEventListener("visibilitychange",q),window.addEventListener("pagehide",Q),W("Partial fill detection initialized")}function R(q={}){let J={...{redirect:!0,debug:P},...q};if(J.debug)window.HubSpotRouterDebug={config:K,determineSchedulerType:L,buildSchedulerUrl:A,handleFormSubmission:M,getCapturedData:()=>window._capturedFormData,getFormName:()=>b,testPartialFill:()=>{let j=window._capturedFormData&&window._capturedFormData.email;if(j)return v(j,b,window.location.pathname),"Partial fill submitted";return"No email captured"}},W("Debug mode enabled. Access via window.HubSpotRouterDebug");d(),p(J),u(),W("HubSpot Form Router initialized with config:",J)}if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",()=>R());else R();window.HubSpotRouter={...window.HubSpotRouter,init:R,handleFormSubmission:M,determineSchedulerType:L,buildSchedulerUrl:A,config:K,DEBUG:P},W("HubSpot Form Router loaded"),W("Script loaded",{debug:P,hasRouter:!!window.HubSpotRouter,url:window.location.href})})();
